Index: ruby-1.8.7-p299/ext/dbm/extconf.rb
===================================================================
--- ruby-1.8.7-p299.orig/ext/dbm/extconf.rb
+++ ruby-1.8.7-p299/ext/dbm/extconf.rb
@@ -26,7 +26,7 @@ def headers.db_check(db)
   case db
   when /^db2?$/
     db_prefix = "__db_n"
-    hsearch = "-DDB_DBM_HSEARCH "
+    hsearch = "-DDB_DBM_HSEARCH -DHAVE_DBM "
   when "gdbm"
     have_gdbm = true
   when "gdbm_compat"
